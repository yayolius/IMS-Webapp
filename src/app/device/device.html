<div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <header-navbar></header-navbar>

            <!-- /.navbar-header -->

            <acme-navbar></acme-navbar>
          
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">


            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header"><i class="fa fa-bar-chart-o fa-fw"></i></a> Sensor {{vm.device.name}}
                     
                      <span ng-if="vm.isUserAdmin || vm.isUserDeviceAdmin">
                       <small class="pull-right"><a class="settings-link" href="#/devices/{{vm.device.id}}/settings">Configurar dispositivo <i class="fa fa-cog"></i></a></small>
                       <small class="pull-right" style="margin:0 24px;"><a class="settings-link" href="#/devices/{{vm.device.id}}/baselines"> Lineas base <i class="fa fa-line-chart"></i></a></small>
                      </span>
                    </h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <div id="container"></div>
            
            <div class="row">
                <div class="col-md-4 ">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h3 class="panel-title">Último dato concentración de polvo (mg/m<sup>3</sup>)</h3>
                      </div>
                      <div class="panel-body">
                            <h2 class="text-center text-warning">{{vm.lastPolutionVal}} <small>mg/m<sup>3</sup></small></span></h2>
                      </div>
                    </div>
                </div>
               <div class="col-md-4 ">
                  <div class="panel panel-info">
                    <div class="panel-heading">
                      <h3 class="panel-title">% de mitigación</h3>
                    </div>
                    <div class="panel-body">
                          <c3chart bindto-id="gauge" chart-data="gauge.data" chart-columns="gauge.columns">
                                  <chart-size chart-height="100"></chart-size> 
                          </c3chart>
                    </div>
                </div>
                </div>
                 <div class="col-md-4 ">
                    <div class="panel panel-info">
                      <div class="panel-heading">
                        <h3 class="panel-title">Dosificación</h3>
                      </div>
                      <div class="panel-body">
                         <rzslider ng-if="vm.device.auto_supresor"  rz-slider-model="vm.slider.value" rz-slider-options="vm.slider.options"></rzslider>
                         <p class="text-center text-warning" ng-if="!vm.device.auto_supresor">Desactivado</p>
                      </div>
                    </div>
                </div>
            </div>
            <div class="row" >
  
              <div class="col-md-12 " ng-if="vm.hasEmptyDatapoints">
                <h3 class="text-danger text-center" ng-if="vm.viewTimespan == 'hour'">No se han recibido datos en la última hora, <a href="javascript:;" ng-click="vm.updateTimespan('day')">prueba cargando el último dia</a>  <br /><br /></h3>

                <h3 class="text-danger text-center" ng-if="vm.viewTimespan == '3hours'">No se han recibido datos en las 3 últimas horas, <a href="javascript:;" ng-click="vm.updateTimespan('day')">prueba cargando el último dia</a>  <br /><br /></h3>

                <h3 class="text-danger text-center" ng-if="vm.viewTimespan == 'day'">No se han recibido datos el ultimo dia, por favor revisar el dispositivo <br /><br /></h3>

              </div>
            </div>

             <div class="row" >
                <div class="col-md-12 ">
                    <div class="panel panel-primary">
                      <div class="panel-heading">
                        
                       
                         <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                                    Cambiar rango de visualización
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li><a ng-class="{'active': vm.viewTimespan == 'hour'}" ng-click="vm.updateTimespan('hour')">1 Hora</a>
                                    </li>
                                    <li><a ng-class="{'active': vm.viewTimespan == '3hours'}" ng-click="vm.updateTimespan('3hours')">3 Horas</a>
                                    </li>
                                    <li><a ng-class="{'active': vm.viewTimespan == 'day'}" ng-click="vm.updateTimespan('day')">1 Dia</a>
                                    </li>
                                </ul>
                            </div>
                         </div>
                         <h2 class="panel-title">Concentración 
                            <strong ng-if="vm.viewTimespan == 'hour'">Última Hora</strong>
                            <strong ng-if="vm.viewTimespan == '3hours'">Últimas 3 Horas</strong>
                            <strong ng-if="vm.viewTimespan == 'day'">Último Día</strong>
                            (mg/m3)
                         </h2>
                      </div>
                      <div class="panel-body" >
                         <div id="time-chart" class="text-center">Cargando gráfico ...</div>
                      </div>
                      <div class="panel-footer">
                        <h4>Exportar datos</h4>
                        <div class="btn-group btn-group-justified" role="group" role="group" aria-label="...">
                          <a ng-href="{{vm.downloadUrls.hour}}" target="_blank" role="button" class="btn btn-primary"><i class="glyphicon glyphicon-download"></i> Última Hora</a>
                          <a ng-href="{{vm.downloadUrls.day}}" target="_blank" role="button" class="btn btn-primary"><i class="glyphicon glyphicon-download"></i>  Último Día</a>
                          <a ng-href="{{vm.downloadUrls.week}}" target="_blank" role="button" class="btn btn-success"><i class="glyphicon glyphicon-download"></i>  Última Semana</a>
                          <a ng-href="{{vm.downloadUrls.month}}" target="_blank" role="button" class="btn btn-warning"><i class="glyphicon glyphicon-download"></i>  Último Mes</a>
                           <a ng-href="{{vm.downloadUrls.all}}" target="_blank" role="button" class="btn btn-danger"><i class="glyphicon glyphicon-download"></i>  Todos los datos</a>
                        </div>

                      </div>
                    </div>
                </div>
            </div>


            <div class="row" ng-if="vm.device.show_calculo">
                <h2>Datapoints</h2>
                <div class="col-md-12">
                   <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Cálculo de optimización</h3>
                    </div>
                    <div class="panel-body">
                   <p style="white-space: pre; margin:0; "> 
                          1 -  ( ( PromedioDeValores    ) / ( HorasTotales * TonelajePromedio ) )  /  ( ( PromedioDeBaselines ) / (  HorasTotalesBaseline * TonelajePromedio ) ) </p> 

                    <p style="white-space: pre; margin:0;"> 
                          1 -  ( ( {{vm.filteredGrid.averageValue}}    ) / ( {{vm.filteredGrid.totalHours}} * {{vm.filteredGrid.averageTonelaje}} ) )  /  ( ( {{vm.filteredBaselineGrid.averageValue}} ) / (  {{vm.filteredBaselineGrid.totalHours}} * {{vm.filteredGrid.averageTonelaje}} ) ) </p>
                    <p style="white-space: pre; margin:0;"> 
                          1 -  ( ( {{vm.filteredGrid.averageValue}}    ) / ( {{vm.filteredGrid.totalHours * vm.filteredGrid.averageTonelaje}} ) )  /  ( ( {{vm.filteredBaselineGrid.averageValue}} ) / (  {{vm.filteredBaselineGrid.totalHours * vm.filteredGrid.averageTonelaje}} ) )</p>
                    <p style="white-space: pre; margin:0;"> 
                          1 -  (  {{vm.filteredGrid.averageValue / (vm.filteredGrid.totalHours * vm.filteredGrid.averageTonelaje) }}   /   {{vm.filteredBaselineGrid.averageValue / (vm.filteredBaselineGrid.totalHours * vm.filteredGrid.averageTonelaje) }}  )</p>
                    <p style="white-space: pre; margin:0;"> 
                          1 -  (  {{ (vm.filteredGrid.averageValue / (vm.filteredGrid.totalHours * vm.filteredGrid.averageTonelaje))   /  (vm.filteredBaselineGrid.averageValue / (vm.filteredBaselineGrid.totalHours * vm.filteredGrid.averageTonelaje)) }}  )</p>
                    <p style="white-space: pre;"> 
                          <strong>Total:</strong>   {{ 1 - (vm.filteredGrid.averageValue / (vm.filteredGrid.totalHours * vm.filteredGrid.averageTonelaje))   /  (vm.filteredBaselineGrid.averageValue / (vm.filteredBaselineGrid.totalHours * vm.filteredGrid.averageTonelaje)) }}  </p>

                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Datapoints</h3>
                    </div>
                    <div class="panel-body">
                      <div class="data">
                        <ul>
                          <li>Percentil Inferior: {{vm.filteredGrid.p10}}</li>
                          <li>Percentil Superior: {{vm.filteredGrid.p90}}</li>
                          <li>Suma: {{vm.filteredGrid.sum}}</li>
                          <li>Promedio: {{vm.filteredGrid.averageValue}}</li>
                        </ul>
                      </div>
                      <div id="grid1" ui-grid="vm.mainGrid" ></div>
                    </div>
                  </div>

                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Datos filtrados y procesados</h3>
                    </div>
                    <div class="panel-body">
                      <div id="grid2" ui-grid="vm.filteredGrid" ></div>
                    </div>
                  </div>

                </div>
            
                 <div class="col-md-6 ">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">Baseline</h3>
                      </div>
                      <div class="panel-body">
                        <div class="data">
                          <ul>
                            <li>Percentil Inferior: {{vm.filteredBaselineGrid.p10}}</li>
                            <li>Percentil Superior: {{vm.filteredBaselineGrid.p90}}</li>
                            <li>Suma: {{vm.filteredBaselineGrid.sum}}</li>
                            <li>Promedio: {{vm.filteredBaselineGrid.averageValue}}</li>
                          </ul>
                        </div>
                        <div id="grid2" ui-grid="vm.baselineGrid" ></div>
                      </div>
                    </div>

                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">Datos filtrados y procesados</h3>
                      </div>
                      <div class="panel-body">
                        <div id="grid2" ui-grid="vm.filteredBaselineGrid" ></div>
                      </div>
                    </div>

                </div>
            </div>

           

            <div class="row" ng-if="vm.markers.length > 0 && !vm.hasEmptyDatapoints">
                <div class="col-md-12 ">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">GPS</h3>
                      </div>
                      <div class="panel-body">
                         <ui-gmap-google-map center='vm.map.center' zoom='vm.map.zoom' bounds="vm.map.bounds" options="vm.map.options">
                            <ui-gmap-markers fit="true" models="vm.markers" coords="'self'" icon="'icon'">
                            </ui-gmap-markers>
                         </ui-gmap-google-map>
                      </div>
                    </div>
                </div>
            </div>


             <div class="row">
                
                

                 <div class="col-md-12 ">
                    <div class="panel panel-default">
                      <div class="panel-body">
                        <form name="formUnassignDevice" novalidate role="form"  >
                          <fieldset>                                                  
                              <div class="form-group">
                                  <input type="submit" ng-disabled="vm.sendingDeviceForm"  class="btn btn-lg btn-danger btn-block" value="Remover dispositivo de mi cuenta"  ng-really-message="Esta seguro que desea remover este dispositivo de su cuenta?" ng-really-click="vm.unassignDevice()" />
                              </div>
                          </fieldset>
                        </form>
                      </div>
                    </div>
                </div>

            </div>
       




            
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->